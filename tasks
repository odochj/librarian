#!/bin/bash

 set -e
 set -u

 COMMAND=$1
 shift || true

 case "$COMMAND" in
  init)
    echo "âš™ï¸  Initializing development environment..."
    # Create venv with uv if it doesn't exist
    if [ ! -d ".venv" ]; then
    uv venv
    fi
    source .venv/bin/activate

    # Install project dependencies (idempotent)
    uv pip install -e .

    # Install pre-commit hooks
    uv run pre-commit install

    ;;

  format)
    echo "ğŸ§¼ Formatting code with ruff..."
    uv run ruff check . --fix
    ;;
  
  lint)
    echo "ğŸ” Linting with Ruff..."
    uv run ruff check .
    ;;

  typecheck)
    echo "ğŸ” Running ty type check..."
    uvx ty check
    ;;

  pre-commit)
    echo "ğŸ”§ Running pre-commit hooks on all files..."
    ./tasks format
    ./tasks lint
    ./tasks typecheck
    ;;

  populate-library)
    uv run python3 src/scripts/populate_library.py
    ;;

  create-curriculum)
    uv run python3 src/scripts/create_curriculum.py
    ;;

  *)
    echo "âŒ Unknown command: $COMMAND"
    echo "Usage: ./tasks [init|format|lint|typecheck]"
    exit 1
    ;;
esac